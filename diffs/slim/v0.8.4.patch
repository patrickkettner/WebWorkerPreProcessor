From 028626e68228bf8d5cce4fc38e588f8d9110bd02 Mon Sep 17 00:00:00 2001
From: Patrick Kettner <patrickkettner@gmail.com>
Date: Sat, 5 Nov 2016 17:24:42 -0700
Subject: [PATCH] .

---
 lib/slim/interpolation.rb | 10 +++++++---
 lib/slim/parser.rb        |  6 +++---
 2 files changed, 10 insertions(+), 6 deletions(-)

diff --git a/lib/slim/interpolation.rb b/lib/slim/interpolation.rb
index 09e5cb9..718bb91 100644
--- a/lib/slim/interpolation.rb
+++ b/lib/slim/interpolation.rb
@@ -36,12 +36,14 @@ module Slim
         if stack.empty? && string =~ /^\}/
           # Stack is empty, this means we are finished
           # if the next character is a closing bracket
-          string.slice!(0)
+	  string = string.slice(1..-1)
           break
         elsif string =~ Parser::DELIMITER_REGEX
           # Delimiter found, push it on the stack
           stack << Parser::DELIMITERS[$1]
-          code << string.slice!(0)
+	  firstChar = string.slice(0)
+	  string = string.slice(1..-1)
+	  code += firstChar
         elsif string =~ Parser::CLOSE_DELIMITER_REGEX
           # Closing delimiter found, pop it from the stack if everything is ok
           raise "Text interpolation: Unexpected closing #{$1}" if stack.empty?
@@ -49,7 +51,9 @@ module Slim
           code << string.slice!(0)
           stack.pop
         else
-          code << string.slice!(0)
+	  firstChar = string.slice(0)
+	  string = string.slice(1..-1)
+	  code += firstChar
         end
       end
 
diff --git a/lib/slim/parser.rb b/lib/slim/parser.rb
index 163635a..abcb1bc 100644
--- a/lib/slim/parser.rb
+++ b/lib/slim/parser.rb
@@ -75,7 +75,7 @@ module Slim
         lineno += 1
 
         # Remove the newline at the end
-        line.chomp!
+	line = line.chomp
 
         # Handle broken lines
         if broken_line
@@ -99,7 +99,7 @@ module Slim
         indent = line[/^[ \t]*/].gsub("\t", @tab).size
 
         # Remove the indentation
-        line.lstrip!
+	line = line.lstrip
 
         # Handle blocks with multiple lines
         if block_indent
@@ -175,7 +175,7 @@ module Slim
                            [:multi, block, [:slim, :text, ' ']]
                          elsif ch == ?/ && line[0] == ?!
                            # HTML comment
-                           line.slice!(0)
+                           line = line.slice(1..-1)
                            [:slim, :comment, block]
                          else
                            in_comment = ch == ?/
-- 
2.10.0

